!function(){"use strict";importScripts("https://www.gstatic.com/firebasejs/5.5.2/firebase.js"),importScripts("https://www.gstatic.com/firebasejs/5.5.2/firebase-app.js"),importScripts("https://www.gstatic.com/firebasejs/5.5.2/firebase-messaging.js");const t="https://sdk.resu.io/Campaign",e=async e=>{let a="";return a=t,a=await _("_tenantId").then((e=>a="5f7a2e8e_1bdb_4739_9d28_278a2759394c"==e?"https://sdk.rsut.io/Campaign":t)),console.log(`Environment: RUN, BaseUrl: ${a}`),a+e};var a={},n={},i={};const o=function(t,a){a=p;var n=0;Promise.all([_("Res_Passport_Id"),_("Res_Profile_Id"),_("_tenantId")]).then((i=>{let o={...t,id:r||a,passportId:i[0]||"",profileID:i[1]||"",tenantId:i[2]||"",domainName:self.registration.scope,status:t.status_code},s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};e("/webCampaignTracking").then((t=>{const e=(t,a)=>fetch(t,a).then((t=>t.json())).then((i=>{n<5&&setTimeout((()=>{e(t,a),n++}),1500)}));e(t,s)}))}))};var s,c="",d=[],l="false",r=null,f="",p=null,u=null;function h(t,e){return new Promise((function(a,n){try{let i=indexedDB.open("resuldata",1);i.onsuccess=function(){try{s=i.result;try{s.objectStoreNames.contains("Res_Data")||s.createObjectStore("Res_Data",{keyPath:"key"})}catch(t){}var o=s.transaction(["Res_Data"],"readwrite").objectStore("Res_Data").put({key:btoa(t),value:btoa(btoa(JSON.stringify(e)))});o.onsuccess=function(t){a("Added to database.")},o.onerror=function(t){n("error: "+t)}}catch(t){}}}catch(t){}}))}function _(t){return new Promise((function(e,a){try{let n=indexedDB.open("resuldata",1);n.onsuccess=function(){try{s=n.result;try{s.objectStoreNames.contains("Res_Data")||s.createObjectStore("Res_Data",{keyPath:"key"})}catch(t){}var i=s.transaction(["Res_Data"],"readwrite").objectStore("Res_Data").get(btoa(t));i.onsuccess=function(t){let n=i.result;if(n&&n.value)try{n.value=JSON.parse(atob(atob(n.value))),e(n.value)}catch(t){a(t)}else a("Not found")},i.onerror=function(t){a(t)}}catch(t){a(t)}}}catch(t){a(t)}}))}addEventListener("fetch",(t=>{t.waitUntil(void(t.clientId&&clients.get(t.clientId).then((t=>{t&&("true"==l&&(t.postMessage({msg:n}),self.clients.matchAll({includeUncontrolled:!0,type:"window"}).then((function(t){t&&t.length&&t[0].postMessage({msg:n})}))),f&&t.postMessage({pass_id:f}))}))))})),self.addEventListener("install",(function(t){self.skipWaiting()})),self.addEventListener("activate",(function(t){t.waitUntil(self.clients.claim()),setInterval(w,15e3)})),self.onnotificationclose=t=>{try{o({action:"dismiss",status_code:"3"},p)}catch(t){}},self.onnotificationclick=t=>{if(t.notification.close(),t.notification.data){const e=t.notification.data.representNotificationData;e&&(c=e.click_actions),"true"===t.notification.data.showInAppNotification&&(l=t.notification.data.showInAppNotification,n=t.notification.data.representNotificationData)}var e={};if(t.notification.data&&t.notification.data.FCM_MSG)return(c=t.notification.data.FCM_MSG.notification.click_action)||(c=self.location.origin),clients.openWindow(c).then((t=>{})),!1;if(d||(d=t.notification.actions),d&&d.length>0&&(d=t.notification.actions),t.notification.data&&"false"===t.notification.data.showInAppNotification&&(t.notification.data.actions&&(d=t.notification.data.actions),t.notification.data.representNotificationData)){const e=t.notification.data.representNotificationData.data,a=JSON.parse(e).actions;d=a}switch(Object.keys(i).includes("notificationClick")&&i.notificationClick(),t.action){case"":e={action:"opened",status_code:"2"},c||(c=self.location.origin),clients.openWindow(c).then((t=>{})),Object.keys(i).includes("notificationViewClick")&&i.notificationViewClick();break;case"later":let n=d.filter((e=>e.action==t.action))[0];e={action:t.action,status_code:"4"},setTimeout((()=>{Object.keys(a).length?g(a):v(y)}),n.duration),Object.keys(i).includes("notificationLaterClick")&&i.notificationLaterClick();break;case"dismiss":e={action:t.action,status_code:"3"},Object.keys(i).includes("notificationDismissClick")&&i.notificationDismissClick();break;default:{let a=d.filter((e=>e.action==t.action))[0];e={action:t.action,status_code:a.actionId};let n=a.actionUrl||"";n||(n=self.location.origin),clients.openWindow(n).then((function(t){}))}}o(e,p)},self.addEventListener("message",(t=>{console.log("message event called");let i=null;try{self.clients.matchAll({includeUncontrolled:!0,type:"window"}).then((function(t){i=t}))}catch(t){}if("event"in t.data){if("ping"==t.data.event){console.log("Pinged");try{self.clients.matchAll({includeUncontrolled:!0,type:"window"}).then((function(t){t&&t.length&&t[0].postMessage({ping:"success"})}))}catch(t){}}if("customEventTest"==t.data.event){const e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.data.payload||t.data.data)};fetch("https://sdklb13.resu.io/Campaign/customeventstest",e).then((t=>t.json())).then((t=>{}))}if("resu_post"==t.data.event){const e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.data.data.payload)};fetch(t.data.data.url,e).then((t=>t.json())).then((t=>{}))}if("customEvent"==t.data.event)Promise.all([_("Res_Passport_Id"),_("Res_Profile_Id"),_("_tenantId"),_("deviceId")]).then((a=>{try{const n={...t.data.payload,passportId:a[0]||"",profileID:a[1]||"",tenantId:a[2]||"",deviceId:a[3]||""},i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)};e("/CustomEvents").then((t=>{let e=Date.now();S(t,n,e,"customEventsClientSw"),fetch(t,i).then((t=>{if(t.ok)return b(e),t.json()})).then((t=>{}))}))}catch(t){}}));else if("userRegisterEvent"==t.data.event){const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.data.payload)};e("/UserRegister").then((t=>{fetch(t,a).then((t=>t.json())).then((t=>{"success"!=t.data&&t.data&&(f=t.data,u=setInterval((()=>{try{self.clients.matchAll({includeUncontrolled:!0,type:"window"}).then((function(t){t&&t.length&&t[0].postMessage({pass_id:f})}))}catch(t){}}),2e3),setTimeout((()=>{clearInterval(u)}),2e4))}))}))}else if("userJourney"==t.data.event){const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.data.payload)};e("/UserJourney").then((t=>{fetch(t,a).then((t=>t.json())).then((t=>{}))}))}else{if("webSdkBlastEvent"==t.data.event){const e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.data.payload)},a=t.data.url;return fetch(a,e).then((t=>t.json())).then((t=>(console.log(t),t)))}if("customMsgEvent"==t.data.event)a=t,t.data,r=t.data.data.id,g(a);else if("dismissInapp"==t.data.event)console.log("dismissInapp tapped"),l="false",n={};else if("notificationqueue"==t.data.event)console.log("notificationqueue",t.data.payload.data),v(t.data.payload);else if("checkSession"==t.data.event)self.registration.showNotification("session closed!");else if("clear_pass_id"==t.data.event)f="",clearInterval(u);else if("dismiss_TBN"==t.data.event)self.clients.matchAll({includeUncontrolled:!0,type:"window"}).then((function(t){t&&t.length&&(t[0].postMessage({event:"dismiss_TBN_tapped"}),i[0].postMessage({event:"dismiss_TBN_tapped"}))}));else if("lastEvent"==t.data.event)try{t.data.data&&Promise.all([_("Res_Passport_Id"),_("Res_Profile_Id"),_("_tenantId"),_("deviceId"),_("domainName"),_("sessionId")]).then((e=>{try{if("Appointment Booked"!=t.data.data){const n={eventName:t.data.data+"_drop_off",passportId:e[0]||"",profileID:e[1]||"",tenantId:e[2]||"",deviceId:e[3]||"",domainName:e[4]||"",sessionId:e[5]||""};try{_("userEmailId").then((t=>{t.length&&(n.email=t)})),_("userMobileNum").then((t=>{t.length&&(n.phNum=t)}))}catch(t){}const i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)};var a="http://10.200.1.23:7511/Campaign/CustomEvents";let o=Date.now();S(a,n,o,"dropOffDataSw"),fetch(a,i).then((t=>{if(t.ok){b(o);return t.json()}})).then((t=>{})).catch((t=>{}))}}catch(t){}}))}catch(t){}}}}));const g=t=>{const e=t.data.data.title;let a={body:t.data.data.body,...JSON.parse(t.data.data.options)};p=t.data.data.id,d=a.actions,c="click_actions"in t.data.data?t.data.data.click_actions:t.data.data.click_action;const n=t.data.data.ttl;console.log(n),function(t,e,a,n,i){const s=new Date((new Date).toUTCString()).toISOString().split(".")[0];if(a&&new Date(s)>=new Date(a)){console.log("Notification Expired")}else{!function(t,e,a,n){e.tag=n,e.data=e,e.showInAppNotification="false",self.registration.showNotification(t,e)}(t,e,0,n),o({action:"received",status_code:"5"},n)}}(e,a,n,p)};firebase.initializeApp({messagingSenderId:"537523308807"});var m=firebase.messaging(),y=null;function v(t){if(t.data.resul&&(t.data=JSON.parse(atob(t.data.resul.substring(4))),t.data.resul&&(t.data=JSON.parse(atob(t.data.resul.substring(4)))),t.data.options=JSON.stringify(t.data.options)),t.data&&t.data.ttl&&"0001-01-01T00:00:00"==t.data.ttl&&(t.data.ttl=""),t.data&&t.data.ttl){const a=t.data.ttl,n=new Date((new Date).toUTCString()).toISOString().split(".")[0];if(new Date(n)>=new Date(a)){console.log("notification expired!",t);var e={action:"expired",status_code:"1"};return new Promise((function(t,e){}))}}const a=JSON.parse(t.data.options);a.tag=t.data.id,"image"==a.type&&(a.image=a.url),d=a.actions;const n=t.data.title;a.data={showInAppNotification:t.data.inAppNotification,representNotificationData:t.data};e={action:"received",status_code:"5"};return p=t.data.id,o(e,t.data.id),self.registration.showNotification(n,a)}function w(){_("Res_Sdk_Failure_Api_List").then((t=>{if(N(t),t&&t.length){N("Res_Sdk_Failure_Api_List:"+JSON.stringify(t));let e=[...t];const a=e.reduce(((t,e)=>{const a=t[e.apiName]||[];return a.push(e),t[e.apiName]=a,t}),{});let n=[],i=[],o={},s=[],c={},d="";Object.keys(a).forEach((t=>{a[t].forEach((t=>{const{rowId:e,url:a,bodyContent:{action:c,status_code:l,id:r,passportId:f,profileID:p,tenantId:u,domainName:h,status:_,deviceId:g,eventName:m,pageUrl:y,sessionId:v},apiName:w}=t,{bodyContent:N}=t;"inAppNotificationTracking"==w?(n=[...n,{action:c,id:r,status:_}],o={passportId:f,profileID:p,tenantId:u,domainName:h,clicks:n}):"custEvent"==w?(i=[...i,{eventName:m,pageUrl:y,sessionId:v,domainName:h}],o={passportId:f,profileID:p,tenantId:u,domainName:h,deviceId:g,events:i}):o=N,s=[...s,e],d=a})),c={method:"POST",body:JSON.stringify(o)},fetch(d,c).then((t=>t.json())).then((t=>{if(1==t.status){h("Res_Sdk_Failure_Api_List",e.filter((t=>!s.includes(t.rowId))))}})).catch((t=>{N("addDBErr",t)}))}))}else N("api-retry-sw-data-not-found")})).catch((t=>{N("api-retry-sw-err",t)}))}function N(t,e=""){_("swDebugEnable").then((a=>{1==a&&(console.log("swdebug enabled"),console.log(`${t} ::: ${e}`))})).catch((t=>{console.log("swdebug disabled")}))}function S(t,e,a,n){_("Res_Sdk_Failure_Api_List").then((i=>{if(i&&i.length){let o=[{rowId:a,url:t,bodyContent:e,status:!0,apiName:n}];o=[...o,...i],h("Res_Sdk_Failure_Api_List",o),N("Res_Sdk_Failure_Api_List:"+JSON.stringify(o))}})).catch((i=>{let o=[{rowId:a,url:t,bodyContent:e,status:!0,apiName:n}];h("Res_Sdk_Failure_Api_List",o),N("Res_Sdk_Failure_Api_List:"+JSON.stringify(o))}))}function b(t){_("Res_Sdk_Failure_Api_List").then((e=>{if(e&&e.length){N("Res_Sdk_Failure_Api_List:"+JSON.stringify(e));let a=[...e];a=a.filter((e=>e.rowId!==t)),h("Res_Sdk_Failure_Api_List",a)}})).catch((e=>{N("Res_Sdk_Failure_Api_List: not found id:"+t)}))}m.setBackgroundMessageHandler((function(t){return y=t,function(t){try{_("ResNotification").then((e=>{e.length>14?(e.shift(),e.push(t)):e.push(t),h("ResNotification",e)}),(e=>{h("ResNotification",[t])}))}catch(t){}}(t),"data"in t?v(y):new Promise((function(t,e){}))}))}();