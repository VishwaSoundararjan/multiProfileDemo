!function(){"use strict";function e(){const e=window.ReWebSDK.utils.LSH;try{if(console_log("socket inited"),"function"==typeof io)try{var t=null,o=null,n=e.getItem("socketConnectedAt")?new Date(e.getItem("socketConnectedAt")):new Date;((new Date).getTime()-n.getTime())/1e3>600&&(localStorage.removeItem("isSocEnabled"),localStorage.setItem("TabsOpen","{}")),function(){let e=JSON.parse(localStorage.getItem("TabsOpen")||"{}"),t="tab_"+(new Date).getTime();sessionStorage.setItem("TabHash",t),e[t]=location.pathname,localStorage.setItem("TabsOpen",JSON.stringify(e))}(),window.onbeforeunload=function(){!function(){let e=sessionStorage.getItem("TabHash"),t=JSON.parse(localStorage.getItem("TabsOpen")||"{}");delete t[e],localStorage.setItem("TabsOpen",JSON.stringify(t))}(),0==Object.entries(JSON.parse(localStorage.getItem("TabsOpen"))||"{}").length&&localStorage.removeItem("isSocEnabled")};var a,s=0;new Date;function c(){let n=new Map,l=JSON.parse(localStorage.getItem("TabsOpen")||"{}");if(Object.keys(l).includes("tab_SocEmitter")||localStorage.removeItem("isSocEnabled"),!localStorage.getItem("isSocEnabled")&&navigator.onLine){try{clearInterval(o)}catch(e){}let r=window.ReWebSDK.configs.webSockBase?window.ReWebSDK.configs.webSockBase:"https://websoc.resu.io";a=io(r,{transports:["websocket"],reconnection:!1}),localStorage.setItem("isSocEnabled",!0),e.setItem("socketConnectedAt",new Date),delete l[sessionStorage.getItem("TabHash")],l.tab_SocEmitter=location.pathname,sessionStorage.setItem("TabHash","tab_SocEmitter"),localStorage.setItem("TabsOpen",JSON.stringify(l)),a.on("connect",(function(e){i()})),a.on("connect_error",(function(){if(localStorage.removeItem("isSocEnabled"),s<2)navigator.onLine&&c();else{a.disconnect();try{clearInterval(t),clearInterval(o)}catch(e){}}s+=1})),a.on("disconnect",(function(){a.off("connect"),a.off("disconnect"),localStorage.removeItem("isSocEnabled"),navigator.onLine||c(),clearInterval(t)})),a.on(window.location.pathname,(function(e){n.set(e.socketId,e),console.log("Total Count",""+n.size)})),a.on("UserDisconnected",(function(e){n.delete(e),console.log("Total Count",""+n.size)})),a.on(window.location.hostname.replace("www.","")+"clients",(function(){i()}))}else{try{clearInterval(o)}catch(e){}o=setInterval((function(){c()}),3e3)}}function i(){try{const t={profileId:e.getItem("Res_Profile_Id")||"",deviceOs:window.ReWebSDK.utils.oSname||"unknown",deviceType:e.getItem("dtype"),browserName:window.ReWebSDK.utils.browserName,domainName:window.location.hostname.replace("www.",""),passportId:e.getItem("Res_Passport_Id")||"",paths:Object.entries(JSON.parse(localStorage.getItem("TabsOpen"))).map((e=>e[1]))};a.emit("NewWebUser",t),window.console_log&&console_log("new web user emitted: ",t),window.addEventListener("storage",(function(e){"TabsOpen"==e.key&&(t.paths=Object.entries(JSON.parse(localStorage.getItem("TabsOpen"))).map((e=>e[1])),a.emit("NewWebUser",t))}),!1)}catch(e){window.console_log&&console_log("new web user emitte err: ",e)}}window.addEventListener("online",(function(){c()})),window.addEventListener("offline",(function(){localStorage.removeItem("isSocEnabled"),clearInterval(t),clearInterval(o)}));try{c()}catch(e){}}catch(e){}}catch(e){console_log("socket err: 1")}}document.querySelector('script[src*="socket.io.js"]')?window.liveVisitors=e():window.ReWebSDK.utils.importDynamicModule((window.ReWebSDK.configs.customFileBase||window.ReWebSDK.configs.custombase||"https://sdk.resu.io")+"/scripts/socket.io.js").then((t=>{window.liveVisitors=e()}))}();
